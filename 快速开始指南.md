# ⚡ 快速开始指南 - 30分钟完成部署

> 这是一个精简版的部署指南，帮你在30分钟内完成从零到部署的全过程。

## 🎯 部署目标

将你的宇宙探索者项目部署到阿里云服务器，实现：
- ✅ 自动化 CI/CD 部署
- ✅ Docker 容器化运行
- ✅ 高可用性和易维护

## ⏱️ 时间安排

- **10分钟**: 阿里云环境准备
- **10分钟**: GitHub 配置
- **10分钟**: 部署和验证

---

## 🚀 第一步：阿里云环境准备 (10分钟)

### 1.1 购买 ECS 服务器 (3分钟)

```bash
# 推荐配置：
# - 实例：2核4GB (ecs.t6-c1m2.large)
# - 系统：Ubuntu 20.04 LTS
# - 存储：40GB SSD
# - 带宽：5Mbps
```

### 1.2 一键安装环境 (5分钟)

```bash
# SSH 连接服务器
ssh root@your-server-ip

# 下载并运行环境安装脚本
curl -fsSL https://raw.githubusercontent.com/你的用户名/cosmos-explorer/main/scripts/server-setup.sh -o setup.sh
chmod +x setup.sh
./setup.sh

# 重新登录使 Docker 权限生效
exit
ssh root@your-server-ip
```

### 1.3 配置阿里云 ACR (2分钟)

```bash
# 1. 访问阿里云控制台 -> 容器镜像服务
# 2. 开通个人版（免费）
# 3. 创建命名空间：cosmos-explorer
# 4. 创建镜像仓库：cosmos-explorer
# 5. 设置 Registry 密码

# 测试 ACR 连接
docker login registry.cn-hangzhou.aliyuncs.com
# 输入你的阿里云账号和 Registry 密码
```

---

## 🐙 第二步：GitHub 配置 (10分钟)

### 2.1 推送代码到 GitHub (3分钟)

```bash
# 在本地项目目录
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/你的用户名/cosmos-explorer.git
git push -u origin main
```

### 2.2 配置 GitHub Secrets (5分钟)

在 GitHub 仓库页面：`Settings` → `Secrets and variables` → `Actions` → `New repository secret`

```bash
# 必需的 Secrets：
ALIYUN_ACCESS_KEY_ID=你的AccessKey_ID
ALIYUN_ACCESS_KEY_SECRET=你的AccessKey_Secret
ALIYUN_DOCKER_USERNAME=你的阿里云账号
ALIYUN_DOCKER_PASSWORD=你的Registry密码
PROD_HOST=你的服务器IP
PROD_USERNAME=root
PROD_SSH_KEY=你的SSH私钥内容
```

### 2.3 修改配置文件 (2分钟)

```bash
# 编辑 .github/workflows/deploy.yml
# 修改第 15-17 行：
env:
  REGISTRY: registry.cn-hangzhou.aliyuncs.com
  IMAGE_NAME: cosmos-explorer
  NAMESPACE: cosmos-explorer  # 你的命名空间

# 提交修改
git add .
git commit -m "配置部署环境"
git push origin main
```

---

## 🎯 第三步：部署和验证 (10分钟)

### 3.1 触发自动部署 (2分钟)

```bash
# 推送代码会自动触发部署
git push origin main

# 或者在 GitHub 页面手动触发：
# Actions → CI/CD Pipeline → Run workflow
```

### 3.2 监控部署过程 (5分钟)

```bash
# 在 GitHub 查看部署进度
# 访问：https://github.com/你的用户名/cosmos-explorer/actions

# 在服务器查看部署状态
ssh root@your-server-ip
docker ps | grep cosmos-explorer
docker logs cosmos-explorer-prod -f
```

### 3.3 验证部署成功 (3分钟)

```bash
# 健康检查
curl http://your-server-ip/health

# 浏览器访问
# http://your-server-ip

# 查看应用状态
./scripts/health-check.sh
```

---

## ✅ 部署完成检查清单

- [ ] ECS 服务器正常运行
- [ ] Docker 和 Docker Compose 已安装
- [ ] 阿里云 ACR 配置完成
- [ ] GitHub Actions 构建成功
- [ ] 容器正常运行
- [ ] 应用可以正常访问
- [ ] 健康检查通过

---

## 🔧 常用命令

```bash
# 查看应用状态
docker ps | grep cosmos-explorer

# 查看应用日志
docker logs cosmos-explorer-prod -f

# 重启应用
docker restart cosmos-explorer-prod

# 健康检查
curl http://localhost/health

# 查看资源使用
docker stats cosmos-explorer-prod

# 进入容器调试
docker exec -it cosmos-explorer-prod sh
```

---

## 🆘 快速故障排除

### 问题1：GitHub Actions 失败
```bash
# 检查 Secrets 是否正确配置
# 查看 Actions 页面的详细错误信息
# 确认 .github/workflows/deploy.yml 配置正确
```

### 问题2：容器无法启动
```bash
# 查看容器日志
docker logs cosmos-explorer-prod

# 检查端口占用
netstat -tlnp | grep :80

# 手动拉取镜像测试
docker pull registry.cn-hangzhou.aliyuncs.com/cosmos-explorer/cosmos-explorer:latest
```

### 问题3：应用无法访问
```bash
# 检查防火墙
sudo ufw status

# 检查容器端口映射
docker port cosmos-explorer-prod

# 检查 nginx 配置
docker exec cosmos-explorer-prod nginx -t
```

---

## 🎉 下一步

部署成功后，你可以：

1. **配置域名**: 将域名解析到服务器 IP
2. **启用 HTTPS**: 配置 SSL 证书
3. **设置监控**: 配置应用监控和告警
4. **性能优化**: 配置 CDN 和缓存
5. **备份策略**: 设置定期备份

---

## 📞 获取帮助

如果遇到问题：

1. 查看详细的 [部署实施指南.md](./部署实施指南.md)
2. 检查 GitHub Actions 的详细日志
3. 运行健康检查脚本：`./scripts/health-check.sh --report`
4. 查看应用日志：`docker logs cosmos-explorer-prod`

**恭喜！你已经成功部署了宇宙探索者项目！** 🌌✨
