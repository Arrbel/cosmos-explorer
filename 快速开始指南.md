# âš¡ å¿«é€Ÿå¼€å§‹æŒ‡å— - 30åˆ†é’Ÿå®Œæˆéƒ¨ç½²

> è¿™æ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„éƒ¨ç½²æŒ‡å—ï¼Œå¸®ä½ åœ¨30åˆ†é’Ÿå†…å®Œæˆä»é›¶åˆ°éƒ¨ç½²çš„å…¨è¿‡ç¨‹ã€‚

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

å°†ä½ çš„å®‡å®™æ¢ç´¢è€…é¡¹ç›®éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå®ç°ï¼š
- âœ… è‡ªåŠ¨åŒ– CI/CD éƒ¨ç½²
- âœ… Docker å®¹å™¨åŒ–è¿è¡Œ
- âœ… é«˜å¯ç”¨æ€§å’Œæ˜“ç»´æŠ¤

## â±ï¸ æ—¶é—´å®‰æ’

- **10åˆ†é’Ÿ**: é˜¿é‡Œäº‘ç¯å¢ƒå‡†å¤‡
- **10åˆ†é’Ÿ**: GitHub é…ç½®
- **10åˆ†é’Ÿ**: éƒ¨ç½²å’ŒéªŒè¯

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šé˜¿é‡Œäº‘ç¯å¢ƒå‡†å¤‡ (10åˆ†é’Ÿ)

### 1.1 è´­ä¹° ECS æœåŠ¡å™¨ (3åˆ†é’Ÿ)

```bash
# æ¨èé…ç½®ï¼š
# - å®ä¾‹ï¼š2æ ¸4GB (ecs.t6-c1m2.large)
# - ç³»ç»Ÿï¼šUbuntu 20.04 LTS
# - å­˜å‚¨ï¼š40GB SSD
# - å¸¦å®½ï¼š5Mbps
```

### 1.2 ä¸€é”®å®‰è£…ç¯å¢ƒ (5åˆ†é’Ÿ)

```bash
# SSH è¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip

# ä¸‹è½½å¹¶è¿è¡Œç¯å¢ƒå®‰è£…è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/cosmos-explorer/main/scripts/server-setup.sh -o setup.sh
chmod +x setup.sh
./setup.sh

# é‡æ–°ç™»å½•ä½¿ Docker æƒé™ç”Ÿæ•ˆ
exit
ssh root@your-server-ip
```

### 1.3 é…ç½®é˜¿é‡Œäº‘ ACR (2åˆ†é’Ÿ)

```bash
# 1. è®¿é—®é˜¿é‡Œäº‘æ§åˆ¶å° -> å®¹å™¨é•œåƒæœåŠ¡
# 2. å¼€é€šä¸ªäººç‰ˆï¼ˆå…è´¹ï¼‰
# 3. åˆ›å»ºå‘½åç©ºé—´ï¼šcosmos-explorer
# 4. åˆ›å»ºé•œåƒä»“åº“ï¼šcosmos-explorer
# 5. è®¾ç½® Registry å¯†ç 

# æµ‹è¯• ACR è¿æ¥
docker login registry.cn-hangzhou.aliyuncs.com
# è¾“å…¥ä½ çš„é˜¿é‡Œäº‘è´¦å·å’Œ Registry å¯†ç 
```

---

## ğŸ™ ç¬¬äºŒæ­¥ï¼šGitHub é…ç½® (10åˆ†é’Ÿ)

### 2.1 æ¨é€ä»£ç åˆ° GitHub (3åˆ†é’Ÿ)

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/cosmos-explorer.git
git push -u origin main
```

### 2.2 é…ç½® GitHub Secrets (5åˆ†é’Ÿ)

åœ¨ GitHub ä»“åº“é¡µé¢ï¼š`Settings` â†’ `Secrets and variables` â†’ `Actions` â†’ `New repository secret`

```bash
# å¿…éœ€çš„ Secretsï¼š
ALIYUN_ACCESS_KEY_ID=ä½ çš„AccessKey_ID
ALIYUN_ACCESS_KEY_SECRET=ä½ çš„AccessKey_Secret
ALIYUN_DOCKER_USERNAME=ä½ çš„é˜¿é‡Œäº‘è´¦å·
ALIYUN_DOCKER_PASSWORD=ä½ çš„Registryå¯†ç 
PROD_HOST=ä½ çš„æœåŠ¡å™¨IP
PROD_USERNAME=root
PROD_SSH_KEY=ä½ çš„SSHç§é’¥å†…å®¹
```

### 2.3 ä¿®æ”¹é…ç½®æ–‡ä»¶ (2åˆ†é’Ÿ)

```bash
# ç¼–è¾‘ .github/workflows/deploy.yml
# ä¿®æ”¹ç¬¬ 15-17 è¡Œï¼š
env:
  REGISTRY: registry.cn-hangzhou.aliyuncs.com
  IMAGE_NAME: cosmos-explorer
  NAMESPACE: cosmos-explorer  # ä½ çš„å‘½åç©ºé—´

# æäº¤ä¿®æ”¹
git add .
git commit -m "é…ç½®éƒ¨ç½²ç¯å¢ƒ"
git push origin main
```

---

## ğŸ¯ ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²å’ŒéªŒè¯ (10åˆ†é’Ÿ)

### 3.1 è§¦å‘è‡ªåŠ¨éƒ¨ç½² (2åˆ†é’Ÿ)

```bash
# æ¨é€ä»£ç ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
git push origin main

# æˆ–è€…åœ¨ GitHub é¡µé¢æ‰‹åŠ¨è§¦å‘ï¼š
# Actions â†’ CI/CD Pipeline â†’ Run workflow
```

### 3.2 ç›‘æ§éƒ¨ç½²è¿‡ç¨‹ (5åˆ†é’Ÿ)

```bash
# åœ¨ GitHub æŸ¥çœ‹éƒ¨ç½²è¿›åº¦
# è®¿é—®ï¼šhttps://github.com/ä½ çš„ç”¨æˆ·å/cosmos-explorer/actions

# åœ¨æœåŠ¡å™¨æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
ssh root@your-server-ip
docker ps | grep cosmos-explorer
docker logs cosmos-explorer-prod -f
```

### 3.3 éªŒè¯éƒ¨ç½²æˆåŠŸ (3åˆ†é’Ÿ)

```bash
# å¥åº·æ£€æŸ¥
curl http://your-server-ip/health

# æµè§ˆå™¨è®¿é—®
# http://your-server-ip

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
./scripts/health-check.sh
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] ECS æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- [ ] Docker å’Œ Docker Compose å·²å®‰è£…
- [ ] é˜¿é‡Œäº‘ ACR é…ç½®å®Œæˆ
- [ ] GitHub Actions æ„å»ºæˆåŠŸ
- [ ] å®¹å™¨æ­£å¸¸è¿è¡Œ
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
docker ps | grep cosmos-explorer

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs cosmos-explorer-prod -f

# é‡å¯åº”ç”¨
docker restart cosmos-explorer-prod

# å¥åº·æ£€æŸ¥
curl http://localhost/health

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats cosmos-explorer-prod

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it cosmos-explorer-prod sh
```

---

## ğŸ†˜ å¿«é€Ÿæ•…éšœæ’é™¤

### é—®é¢˜1ï¼šGitHub Actions å¤±è´¥
```bash
# æ£€æŸ¥ Secrets æ˜¯å¦æ­£ç¡®é…ç½®
# æŸ¥çœ‹ Actions é¡µé¢çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
# ç¡®è®¤ .github/workflows/deploy.yml é…ç½®æ­£ç¡®
```

### é—®é¢˜2ï¼šå®¹å™¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs cosmos-explorer-prod

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :80

# æ‰‹åŠ¨æ‹‰å–é•œåƒæµ‹è¯•
docker pull registry.cn-hangzhou.aliyuncs.com/cosmos-explorer/cosmos-explorer:latest
```

### é—®é¢˜3ï¼šåº”ç”¨æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥å®¹å™¨ç«¯å£æ˜ å°„
docker port cosmos-explorer-prod

# æ£€æŸ¥ nginx é…ç½®
docker exec cosmos-explorer-prod nginx -t
```

---

## ğŸ‰ ä¸‹ä¸€æ­¥

éƒ¨ç½²æˆåŠŸåï¼Œä½ å¯ä»¥ï¼š

1. **é…ç½®åŸŸå**: å°†åŸŸåè§£æåˆ°æœåŠ¡å™¨ IP
2. **å¯ç”¨ HTTPS**: é…ç½® SSL è¯ä¹¦
3. **è®¾ç½®ç›‘æ§**: é…ç½®åº”ç”¨ç›‘æ§å’Œå‘Šè­¦
4. **æ€§èƒ½ä¼˜åŒ–**: é…ç½® CDN å’Œç¼“å­˜
5. **å¤‡ä»½ç­–ç•¥**: è®¾ç½®å®šæœŸå¤‡ä»½

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹è¯¦ç»†çš„ [éƒ¨ç½²å®æ–½æŒ‡å—.md](./éƒ¨ç½²å®æ–½æŒ‡å—.md)
2. æ£€æŸ¥ GitHub Actions çš„è¯¦ç»†æ—¥å¿—
3. è¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬ï¼š`./scripts/health-check.sh --report`
4. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`docker logs cosmos-explorer-prod`

**æ­å–œï¼ä½ å·²ç»æˆåŠŸéƒ¨ç½²äº†å®‡å®™æ¢ç´¢è€…é¡¹ç›®ï¼** ğŸŒŒâœ¨
