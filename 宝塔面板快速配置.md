# ⚡ 宝塔面板快速配置指南

> 10分钟完成宝塔面板 Docker 部署配置

## 🎯 配置目标

- ✅ 在宝塔面板中安装和配置 Docker
- ✅ 通过可视化界面管理容器
- ✅ 实现一键部署和更新

## 📋 前置条件

- 已安装宝塔面板的阿里云 ECS 服务器
- 服务器可以正常访问互联网
- 具有 root 权限

## 🚀 第一步：安装 Docker (3分钟)

### 方法一：通过宝塔面板安装 (推荐)

1. **登录宝塔面板**
   ```
   访问: http://你的服务器IP:8888
   输入用户名和密码
   ```

2. **安装 Docker**
   ```
   左侧菜单 → Docker → 立即安装
   等待安装完成（约2-3分钟）
   ```

3. **验证安装**
   ```
   安装完成后，Docker 菜单应该可以正常使用
   可以看到：镜像管理、容器管理、网络管理等选项
   ```

### 方法二：命令行安装

```bash
# SSH 连接服务器
ssh root@你的服务器IP

# 安装 Docker
curl -fsSL https://get.docker.com | sh

# 启动 Docker 服务
systemctl start docker
systemctl enable docker

# 验证安装
docker --version
```

## 🔧 第二步：配置项目 (5分钟)

### 2.1 上传项目文件

**方法一：通过宝塔文件管理器**

1. **创建项目目录**
   ```
   宝塔面板 → 文件 → /www/wwwroot/
   新建文件夹: cosmos-explorer
   ```

2. **上传项目文件**
   ```
   将项目打包成 zip 文件
   上传到 /www/wwwroot/cosmos-explorer/
   解压缩
   ```

**方法二：通过 Git 克隆**

```bash
# SSH 连接服务器
cd /www/wwwroot
git clone https://github.com/你的用户名/cosmos-explorer.git
```

### 2.2 检查必要文件

确保项目包含以下文件：
```
cosmos-explorer/
├── Dockerfile              ✅ 必需
├── nginx.conf              ✅ 必需  
├── package.json            ✅ 必需
├── src/                    ✅ 源代码
└── scripts/deploy-baota.sh ✅ 部署脚本
```

## 🐳 第三步：Docker 部署 (2分钟)

### 方法一：宝塔面板可视化部署

1. **构建镜像**
   ```
   Docker → 镜像管理 → 构建镜像
   
   镜像名称: cosmos-explorer
   标签: latest
   Dockerfile路径: /www/wwwroot/cosmos-explorer/Dockerfile
   构建上下文: /www/wwwroot/cosmos-explorer
   
   点击"开始构建"
   ```

2. **创建容器**
   ```
   Docker → 容器管理 → 创建容器
   
   选择镜像: cosmos-explorer:latest
   容器名称: cosmos-explorer-app
   端口映射: 80:80
   重启策略: always
   
   点击"创建并启动"
   ```

### 方法二：一键脚本部署

```bash
# SSH 连接服务器
cd /www/wwwroot/cosmos-explorer

# 设置脚本权限
chmod +x scripts/deploy-baota.sh

# 执行部署
./scripts/deploy-baota.sh production main
```

## ✅ 第四步：验证部署

### 4.1 检查容器状态

**宝塔面板检查：**
```
Docker → 容器管理
查看 cosmos-explorer-app 状态应为"运行中"
```

**命令行检查：**
```bash
# 查看容器状态
docker ps | grep cosmos-explorer

# 查看容器日志
docker logs cosmos-explorer-app -f
```

### 4.2 访问应用

```bash
# 浏览器访问
http://你的服务器IP

# 健康检查
curl http://你的服务器IP/health
```

## 🔄 日常管理操作

### 更新应用

**方法一：宝塔面板操作**
```
1. 文件管理 → 进入项目目录 → 终端
2. 执行: git pull origin main
3. Docker → 容器管理 → 重启容器
```

**方法二：一键更新脚本**
```bash
# 创建更新脚本
cat > /www/wwwroot/update-cosmos.sh << 'EOF'
#!/bin/bash
cd /www/wwwroot/cosmos-explorer
git pull origin main
docker restart cosmos-explorer-app
echo "✅ 更新完成！"
EOF

chmod +x /www/wwwroot/update-cosmos.sh

# 执行更新
./update-cosmos.sh
```

### 查看日志

**宝塔面板：**
```
Docker → 容器管理 → 找到容器 → 日志
```

**命令行：**
```bash
# 实时日志
docker logs cosmos-explorer-app -f

# 最近100行日志
docker logs cosmos-explorer-app --tail 100
```

### 重启应用

**宝塔面板：**
```
Docker → 容器管理 → 找到容器 → 重启
```

**命令行：**
```bash
docker restart cosmos-explorer-app
```

## 🛡️ 安全配置

### 防火墙设置

```
宝塔面板 → 安全 → 防火墙

开放端口：
- 22    (SSH)
- 80    (HTTP)  
- 443   (HTTPS)
- 8888  (宝塔面板)

关闭其他不必要的端口
```

### SSL 证书配置

```
宝塔面板 → 网站 → 添加站点

域名: your-domain.com
根目录: /www/wwwroot/cosmos-explorer

SSL → Let's Encrypt → 申请免费证书
```

## 📊 监控配置

### 宝塔监控

```
宝塔面板 → 监控

设置告警：
- CPU 使用率 > 80%
- 内存使用率 > 80%  
- 磁盘使用率 > 85%
```

### 容器监控脚本

```bash
# 创建监控脚本
cat > /www/wwwroot/monitor-cosmos.sh << 'EOF'
#!/bin/bash

# 检查容器是否运行
if ! docker ps | grep -q cosmos-explorer-app; then
    echo "$(date): 容器异常，尝试重启..." >> /var/log/cosmos-monitor.log
    docker start cosmos-explorer-app
    
    # 发送通知（可选）
    # curl -X POST -H 'Content-type: application/json' \
    #   --data '{"text":"宇宙探索者容器异常重启"}' \
    #   YOUR_SLACK_WEBHOOK_URL
fi
EOF

chmod +x /www/wwwroot/monitor-cosmos.sh

# 添加到定时任务
# 宝塔面板 → 计划任务 → Shell脚本
# 执行周期：每5分钟
# 脚本内容：/www/wwwroot/monitor-cosmos.sh
```

## 🔧 故障排除

### 常见问题

**1. Docker 安装失败**
```bash
# 手动安装
curl -fsSL https://get.docker.com | sh
systemctl start docker
```

**2. 容器无法启动**
```bash
# 查看详细错误
docker logs cosmos-explorer-app

# 检查端口占用
netstat -tlnp | grep :80

# 重新构建镜像
cd /www/wwwroot/cosmos-explorer
docker build -t cosmos-explorer:latest .
```

**3. 应用无法访问**
```bash
# 检查防火墙
ufw status

# 检查容器端口映射
docker port cosmos-explorer-app

# 检查 nginx 配置
docker exec cosmos-explorer-app nginx -t
```

### 日志查看

```bash
# 应用日志
docker logs cosmos-explorer-app -f

# 系统日志
journalctl -f

# 宝塔日志
tail -f /www/server/panel/logs/error.log
```

## 📞 快速参考

### 常用命令

```bash
# 查看容器状态
docker ps

# 重启容器
docker restart cosmos-explorer-app

# 查看日志
docker logs cosmos-explorer-app -f

# 进入容器
docker exec -it cosmos-explorer-app sh

# 更新应用
cd /www/wwwroot/cosmos-explorer && git pull && docker restart cosmos-explorer-app
```

### 宝塔面板路径

```
项目目录: /www/wwwroot/cosmos-explorer
日志目录: /www/server/panel/logs/
备份目录: /www/backup/
```

### 重要端口

```
宝塔面板: 8888
HTTP: 80
HTTPS: 443
SSH: 22
```

## 🎉 完成！

现在你已经成功配置了宝塔面板 Docker 部署环境！

**下一步可以：**
- 配置域名和 SSL 证书
- 设置自动备份
- 配置 CDN 加速
- 添加监控告警

**需要帮助？**
- 查看 [宝塔面板部署指南.md](./宝塔面板部署指南.md)
- 运行健康检查：`./scripts/health-check.sh`
- 查看容器日志：`docker logs cosmos-explorer-app -f`
