# âš¡ å®å¡”é¢æ¿å¿«é€Ÿé…ç½®æŒ‡å—

> 10åˆ†é’Ÿå®Œæˆå®å¡”é¢æ¿ Docker éƒ¨ç½²é…ç½®

## ğŸ¯ é…ç½®ç›®æ ‡

- âœ… åœ¨å®å¡”é¢æ¿ä¸­å®‰è£…å’Œé…ç½® Docker
- âœ… é€šè¿‡å¯è§†åŒ–ç•Œé¢ç®¡ç†å®¹å™¨
- âœ… å®ç°ä¸€é”®éƒ¨ç½²å’Œæ›´æ–°

## ğŸ“‹ å‰ç½®æ¡ä»¶

- å·²å®‰è£…å®å¡”é¢æ¿çš„é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨
- æœåŠ¡å™¨å¯ä»¥æ­£å¸¸è®¿é—®äº’è”ç½‘
- å…·æœ‰ root æƒé™

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šå®‰è£… Docker (3åˆ†é’Ÿ)

### æ–¹æ³•ä¸€ï¼šé€šè¿‡å®å¡”é¢æ¿å®‰è£… (æ¨è)

1. **ç™»å½•å®å¡”é¢æ¿**
   ```
   è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:8888
   è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   ```

2. **å®‰è£… Docker**
   ```
   å·¦ä¾§èœå• â†’ Docker â†’ ç«‹å³å®‰è£…
   ç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦2-3åˆ†é’Ÿï¼‰
   ```

3. **éªŒè¯å®‰è£…**
   ```
   å®‰è£…å®Œæˆåï¼ŒDocker èœå•åº”è¯¥å¯ä»¥æ­£å¸¸ä½¿ç”¨
   å¯ä»¥çœ‹åˆ°ï¼šé•œåƒç®¡ç†ã€å®¹å™¨ç®¡ç†ã€ç½‘ç»œç®¡ç†ç­‰é€‰é¡¹
   ```

### æ–¹æ³•äºŒï¼šå‘½ä»¤è¡Œå®‰è£…

```bash
# SSH è¿æ¥æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# å®‰è£… Docker
curl -fsSL https://get.docker.com | sh

# å¯åŠ¨ Docker æœåŠ¡
systemctl start docker
systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
```

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šé…ç½®é¡¹ç›® (5åˆ†é’Ÿ)

### 2.1 ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**æ–¹æ³•ä¸€ï¼šé€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨**

1. **åˆ›å»ºé¡¹ç›®ç›®å½•**
   ```
   å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ /www/wwwroot/
   æ–°å»ºæ–‡ä»¶å¤¹: cosmos-explorer
   ```

2. **ä¸Šä¼ é¡¹ç›®æ–‡ä»¶**
   ```
   å°†é¡¹ç›®æ‰“åŒ…æˆ zip æ–‡ä»¶
   ä¸Šä¼ åˆ° /www/wwwroot/cosmos-explorer/
   è§£å‹ç¼©
   ```

**æ–¹æ³•äºŒï¼šé€šè¿‡ Git å…‹éš†**

```bash
# SSH è¿æ¥æœåŠ¡å™¨
cd /www/wwwroot
git clone https://github.com/ä½ çš„ç”¨æˆ·å/cosmos-explorer.git
```

### 2.2 æ£€æŸ¥å¿…è¦æ–‡ä»¶

ç¡®ä¿é¡¹ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
```
cosmos-explorer/
â”œâ”€â”€ Dockerfile              âœ… å¿…éœ€
â”œâ”€â”€ nginx.conf              âœ… å¿…éœ€  
â”œâ”€â”€ package.json            âœ… å¿…éœ€
â”œâ”€â”€ src/                    âœ… æºä»£ç 
â””â”€â”€ scripts/deploy-baota.sh âœ… éƒ¨ç½²è„šæœ¬
```

## ğŸ³ ç¬¬ä¸‰æ­¥ï¼šDocker éƒ¨ç½² (2åˆ†é’Ÿ)

### æ–¹æ³•ä¸€ï¼šå®å¡”é¢æ¿å¯è§†åŒ–éƒ¨ç½²

1. **æ„å»ºé•œåƒ**
   ```
   Docker â†’ é•œåƒç®¡ç† â†’ æ„å»ºé•œåƒ
   
   é•œåƒåç§°: cosmos-explorer
   æ ‡ç­¾: latest
   Dockerfileè·¯å¾„: /www/wwwroot/cosmos-explorer/Dockerfile
   æ„å»ºä¸Šä¸‹æ–‡: /www/wwwroot/cosmos-explorer
   
   ç‚¹å‡»"å¼€å§‹æ„å»º"
   ```

2. **åˆ›å»ºå®¹å™¨**
   ```
   Docker â†’ å®¹å™¨ç®¡ç† â†’ åˆ›å»ºå®¹å™¨
   
   é€‰æ‹©é•œåƒ: cosmos-explorer:latest
   å®¹å™¨åç§°: cosmos-explorer-app
   ç«¯å£æ˜ å°„: 80:80
   é‡å¯ç­–ç•¥: always
   
   ç‚¹å‡»"åˆ›å»ºå¹¶å¯åŠ¨"
   ```

### æ–¹æ³•äºŒï¼šä¸€é”®è„šæœ¬éƒ¨ç½²

```bash
# SSH è¿æ¥æœåŠ¡å™¨
cd /www/wwwroot/cosmos-explorer

# è®¾ç½®è„šæœ¬æƒé™
chmod +x scripts/deploy-baota.sh

# æ‰§è¡Œéƒ¨ç½²
./scripts/deploy-baota.sh production main
```

## âœ… ç¬¬å››æ­¥ï¼šéªŒè¯éƒ¨ç½²

### 4.1 æ£€æŸ¥å®¹å™¨çŠ¶æ€

**å®å¡”é¢æ¿æ£€æŸ¥ï¼š**
```
Docker â†’ å®¹å™¨ç®¡ç†
æŸ¥çœ‹ cosmos-explorer-app çŠ¶æ€åº”ä¸º"è¿è¡Œä¸­"
```

**å‘½ä»¤è¡Œæ£€æŸ¥ï¼š**
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep cosmos-explorer

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs cosmos-explorer-app -f
```

### 4.2 è®¿é—®åº”ç”¨

```bash
# æµè§ˆå™¨è®¿é—®
http://ä½ çš„æœåŠ¡å™¨IP

# å¥åº·æ£€æŸ¥
curl http://ä½ çš„æœåŠ¡å™¨IP/health
```

## ğŸ”„ æ—¥å¸¸ç®¡ç†æ“ä½œ

### æ›´æ–°åº”ç”¨

**æ–¹æ³•ä¸€ï¼šå®å¡”é¢æ¿æ“ä½œ**
```
1. æ–‡ä»¶ç®¡ç† â†’ è¿›å…¥é¡¹ç›®ç›®å½• â†’ ç»ˆç«¯
2. æ‰§è¡Œ: git pull origin main
3. Docker â†’ å®¹å™¨ç®¡ç† â†’ é‡å¯å®¹å™¨
```

**æ–¹æ³•äºŒï¼šä¸€é”®æ›´æ–°è„šæœ¬**
```bash
# åˆ›å»ºæ›´æ–°è„šæœ¬
cat > /www/wwwroot/update-cosmos.sh << 'EOF'
#!/bin/bash
cd /www/wwwroot/cosmos-explorer
git pull origin main
docker restart cosmos-explorer-app
echo "âœ… æ›´æ–°å®Œæˆï¼"
EOF

chmod +x /www/wwwroot/update-cosmos.sh

# æ‰§è¡Œæ›´æ–°
./update-cosmos.sh
```

### æŸ¥çœ‹æ—¥å¿—

**å®å¡”é¢æ¿ï¼š**
```
Docker â†’ å®¹å™¨ç®¡ç† â†’ æ‰¾åˆ°å®¹å™¨ â†’ æ—¥å¿—
```

**å‘½ä»¤è¡Œï¼š**
```bash
# å®æ—¶æ—¥å¿—
docker logs cosmos-explorer-app -f

# æœ€è¿‘100è¡Œæ—¥å¿—
docker logs cosmos-explorer-app --tail 100
```

### é‡å¯åº”ç”¨

**å®å¡”é¢æ¿ï¼š**
```
Docker â†’ å®¹å™¨ç®¡ç† â†’ æ‰¾åˆ°å®¹å™¨ â†’ é‡å¯
```

**å‘½ä»¤è¡Œï¼š**
```bash
docker restart cosmos-explorer-app
```

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### é˜²ç«å¢™è®¾ç½®

```
å®å¡”é¢æ¿ â†’ å®‰å…¨ â†’ é˜²ç«å¢™

å¼€æ”¾ç«¯å£ï¼š
- 22    (SSH)
- 80    (HTTP)  
- 443   (HTTPS)
- 8888  (å®å¡”é¢æ¿)

å…³é—­å…¶ä»–ä¸å¿…è¦çš„ç«¯å£
```

### SSL è¯ä¹¦é…ç½®

```
å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹

åŸŸå: your-domain.com
æ ¹ç›®å½•: /www/wwwroot/cosmos-explorer

SSL â†’ Let's Encrypt â†’ ç”³è¯·å…è´¹è¯ä¹¦
```

## ğŸ“Š ç›‘æ§é…ç½®

### å®å¡”ç›‘æ§

```
å®å¡”é¢æ¿ â†’ ç›‘æ§

è®¾ç½®å‘Šè­¦ï¼š
- CPU ä½¿ç”¨ç‡ > 80%
- å†…å­˜ä½¿ç”¨ç‡ > 80%  
- ç£ç›˜ä½¿ç”¨ç‡ > 85%
```

### å®¹å™¨ç›‘æ§è„šæœ¬

```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > /www/wwwroot/monitor-cosmos.sh << 'EOF'
#!/bin/bash

# æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
if ! docker ps | grep -q cosmos-explorer-app; then
    echo "$(date): å®¹å™¨å¼‚å¸¸ï¼Œå°è¯•é‡å¯..." >> /var/log/cosmos-monitor.log
    docker start cosmos-explorer-app
    
    # å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
    # curl -X POST -H 'Content-type: application/json' \
    #   --data '{"text":"å®‡å®™æ¢ç´¢è€…å®¹å™¨å¼‚å¸¸é‡å¯"}' \
    #   YOUR_SLACK_WEBHOOK_URL
fi
EOF

chmod +x /www/wwwroot/monitor-cosmos.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
# å®å¡”é¢æ¿ â†’ è®¡åˆ’ä»»åŠ¡ â†’ Shellè„šæœ¬
# æ‰§è¡Œå‘¨æœŸï¼šæ¯5åˆ†é’Ÿ
# è„šæœ¬å†…å®¹ï¼š/www/wwwroot/monitor-cosmos.sh
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. Docker å®‰è£…å¤±è´¥**
```bash
# æ‰‹åŠ¨å®‰è£…
curl -fsSL https://get.docker.com | sh
systemctl start docker
```

**2. å®¹å™¨æ— æ³•å¯åŠ¨**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker logs cosmos-explorer-app

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :80

# é‡æ–°æ„å»ºé•œåƒ
cd /www/wwwroot/cosmos-explorer
docker build -t cosmos-explorer:latest .
```

**3. åº”ç”¨æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥é˜²ç«å¢™
ufw status

# æ£€æŸ¥å®¹å™¨ç«¯å£æ˜ å°„
docker port cosmos-explorer-app

# æ£€æŸ¥ nginx é…ç½®
docker exec cosmos-explorer-app nginx -t
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# åº”ç”¨æ—¥å¿—
docker logs cosmos-explorer-app -f

# ç³»ç»Ÿæ—¥å¿—
journalctl -f

# å®å¡”æ—¥å¿—
tail -f /www/server/panel/logs/error.log
```

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# é‡å¯å®¹å™¨
docker restart cosmos-explorer-app

# æŸ¥çœ‹æ—¥å¿—
docker logs cosmos-explorer-app -f

# è¿›å…¥å®¹å™¨
docker exec -it cosmos-explorer-app sh

# æ›´æ–°åº”ç”¨
cd /www/wwwroot/cosmos-explorer && git pull && docker restart cosmos-explorer-app
```

### å®å¡”é¢æ¿è·¯å¾„

```
é¡¹ç›®ç›®å½•: /www/wwwroot/cosmos-explorer
æ—¥å¿—ç›®å½•: /www/server/panel/logs/
å¤‡ä»½ç›®å½•: /www/backup/
```

### é‡è¦ç«¯å£

```
å®å¡”é¢æ¿: 8888
HTTP: 80
HTTPS: 443
SSH: 22
```

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å·²ç»æˆåŠŸé…ç½®äº†å®å¡”é¢æ¿ Docker éƒ¨ç½²ç¯å¢ƒï¼

**ä¸‹ä¸€æ­¥å¯ä»¥ï¼š**
- é…ç½®åŸŸåå’Œ SSL è¯ä¹¦
- è®¾ç½®è‡ªåŠ¨å¤‡ä»½
- é…ç½® CDN åŠ é€Ÿ
- æ·»åŠ ç›‘æ§å‘Šè­¦

**éœ€è¦å¸®åŠ©ï¼Ÿ**
- æŸ¥çœ‹ [å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md](./å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md)
- è¿è¡Œå¥åº·æ£€æŸ¥ï¼š`./scripts/health-check.sh`
- æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs cosmos-explorer-app -f`
